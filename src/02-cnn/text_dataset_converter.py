# -*- coding: utf-8 -*-
"""text_dataset_converter.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1PkR06z-NeA0mRWvv0aiqRiOIOhuLs6G7
"""

import numpy as pd
import pandas as pd

from google.colab import drive
drive.mount('/content/drive')

# Read dataset
events_fp = "drive/Team Drives/Deep Learning Project/events.csv"
events_df = pd.read_csv(events_fp, index_col="id_odsp")
events_df = events_df.iloc[:,1:]

# Select only text from the first half of games
events_df = events_df[ events_df['time'] <= 60 ]
events_df = events_df[['text']]
events_df.head(5)

# Read dataset
ginf_fp = "drive/Team Drives/Deep Learning Project/ginf.csv"
ginf_df = pd.read_csv(ginf_fp, index_col="id_odsp")
ginf_df = ginf_df.iloc[:,1:]

# Select only games that have detail
ginf_df = ginf_df[ ginf_df['adv_stats'] == True ]
ginf_df = ginf_df[['ht', 'at', 'fthg', 'ftag']] # Choose only necessary columns
ginf_df.head(5)

def get_winner(sr):
  if sr.fthg > sr.ftag:
    return 'home'
  elif sr.fthg < sr.ftag:
    return 'away'
  return 'tie'

# Add winner column
winner_list =[]
for index, row in ginf_df.iterrows():
  winner_list.append(get_winner(row))
ginf_df = ginf_df.assign(winner=pd.Series(winner_list).values)

# Combine into text dataset
df = events_df.join(ginf_df)
df.head(3)
print(events_df.shape)
print(ginf_df.shape)
print(df.shape)

# Write to file with only necessary columns
df.to_csv("drive/Team Drives/Deep Learning Project/ken_cnn/text_dataset_60min.csv", sep='\t')